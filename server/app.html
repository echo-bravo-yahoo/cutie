<html>
  <head>
    <script>
      function feedback(res) {
        if (res.$metadata.httpStatusCode === 200) {
          document.querySelector('#response').innerText = 'Success'
        } else {
          document.querySelector('#response').innerText
            = `Error:\n${JSON.stringify(res, null, 4)}`
        }
      }

      async function ac(event) {
        const url = `/thermostat/${event.target.attributes["data-action"].value}`
        const res = await fetch(url).then((res) => res.json())
        feedback(res)
      }

      async function lamp() {
        const url = `/lamp/toggle`
        const res = await fetch(url).then((res) => res.json())
        feedback(res)
      }

      async function growLights() {
        const url = `/growLights/toggle`
        const res = await fetch(url).then((res) => res.json())
        feedback(res)
      }

      async function print(event) {
        const payload = { payload: event.target.parentElement.querySelector('textarea').value, timestamp: Date.now() }
        const url = '/thermal-printer'
        const fetchArgs = {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        }
        const res = await fetch(url, fetchArgs)
          .then((res) => res.json())
        feedback(res)
      }
    </script>
    <style>
      .container {
        float: left;
        clear: both;
        padding-top: 15px;
        padding-bottom: 15px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      Thermostat
      <button onclick="ac(event)" data-action="coldest">Coldest</button>
      <button onclick="ac(event)" data-action="cold">Cold</button>
      <button onclick="ac(event)" data-action="fanOnly">Fan only</button>
      <button onclick="ac(event)" data-action="auto">Auto</button>
      <button onclick="ac(event)" data-action="off">Off</button>
      <button onclick="ac(event)" data-action="hot">Hot</button>
      <button onclick="ac(event)" data-action="hottest">Hottest</button>
    </div>
    <div class="container">
      Thermal printer
      <textarea></textarea>
      <button onclick="print(event)">Print</button>
    </div>
    <div class="container">
      Bedroom lamp
      <button onclick="lamp()">Toggle</button>
    </div>
    <div class="container">
      Grow lights
      <button onclick="growLights()">Toggle</button>
    </div>
    <div class="container" id="response">
    </div>
  </body>
</html>
